{% extends 'inventory/base.html' %}

{% block title %}Pet Supplies Inventory{% endblock %}


{% block content %}
<div class="conmain">
    {% if messages %}
        {% for message in messages %}
            <div class="status-message {% if message.tags %}{{ message.tags }}{% endif %}">
                {{ message }}
            </div>
        {% endfor %}
    {% endif %}

    {% if user.is_authenticated %}
        {% if warning_items %}
            <div class="warning">
                <h1>Low Stock Warning!</h1>
                <p>Some items are running low on stock.</p>
                <a href="{% url 'low_stock_supplies' %}" class="filter-button">View Low Stock Items</a>
            </div>
        {% endif %}

        <div class="filter">
            <input type="text" id="nameFilter" placeholder="Filter by name...">
            <input type="text" id="locationFilter" placeholder="Filter by location...">
            <select id="categoryFilter">
                <option value="">All Categories</option>
                {% for category in categories %}
                    <option value="{{ category.name }}">{{ category.name }}</option>
                {% endfor %}
            </select>
            <button onclick="applyFilters()">Apply Filters</button>
            <button onclick="clearFilters()">Clear Filters</button>
        </div>

        <div class="table-container">
            <div class="action-bar">
                <a href="{% url 'add_supply' %}" class="add-button">
                    <i class="fas fa-plus"></i>
                    Add New Item
                </a>
            </div>

            <table class="data_tab">
                <thead>
                    <tr>
                        <th class="name_head">Name</th>
                        <th class="Price_head">Price</th>
                        <th class="Quan_head">Quantity</th>
                        <th class="loc_head">Location</th>
                        <th class="cat_head">Category</th>
                        <th class="tag_head">Tags</th>
                        <th class="action_head">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in supplies %}
                        <tr {% if item.quantity <= item.low_stock_threshold %}class="low-stock"{% endif %}>
                            <td class="name_row">
                                {{ item.name }}
                                {% if item.quantity <= item.low_stock_threshold %}
                                    <span class="low-stock-warning">(!)</span>
                                {% endif %}
                            </td>
                            <td class="Price_row">${{ item.price }}</td>
                            <td class="Quan_row">{{ item.quantity }}</td>
                            <td class="loc_row">{{ item.location|default:"-" }}</td>
                            <td class="cat_row">
                                {% if item.category %}
                                    <span class="category-badge">{{ item.category.name }}</span>
                                {% else %}
                                    -
                                {% endif %}
                            </td>
                            <td class="tag_row">
                                <div class="category-tag">
                                    {% if item.tags.all %}
                                        {% for tag in item.tags.all %}
                                            <span class="tag-badge">{{ tag.name }}</span>
                                        {% endfor %}
                                    {% else %}
                                        -
                                    {% endif %}
                                </div>
                            </td>
                            <td class="action_row">
                                <div class="action-buttons">
                                    <a href="{% url 'edit_supply' item.name %}" class="edit-button">
                                        <i class="fas fa-edit"></i>
                                        Edit
                                    </a>
                                    <a href="{% url 'delete_supply' item.name %}" class="delete-button">
                                        <i class="fas fa-trash"></i>
                                        Delete
                                    </a>
                                </div>
                            </td>
                        </tr>
                    {% empty %}
                        <tr>
                            <td colspan="7" class="no-data">No items found</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="bottom_nav">
            <table>
                <tr>
                    <td class="blank"></td>
                    <td class="export">
                        <a href="{% url 'export_supplies' %}" class="export-button">Export</a>
                    </td>
                    <td class="import">
                        <a href="{% url 'import_supplies' %}" class="import-button">Import</a>
                    </td>
                </tr>
            </table>
        </div>
    {% else %}
        <div class="login-notice">
            Please log in to view and manage inventory items.
        </div>
    {% endif %}
</div>

<script>
function applyFilters() {
    const nameFilter = document.getElementById('nameFilter').value.toLowerCase();
    const locationFilter = document.getElementById('locationFilter').value.toLowerCase();
    const categoryFilter = document.getElementById('categoryFilter').value.toLowerCase();
    const rows = document.querySelectorAll('.data_tab tbody tr');

    rows.forEach(row => {
        const name = row.querySelector('.name_row').textContent.toLowerCase();
        const location = row.querySelector('.loc_row').textContent.toLowerCase();
        const categoryElement = row.querySelector('.cat_row .category-badge');
        const category = categoryElement ? categoryElement.textContent.toLowerCase() : '';

        const nameMatch = name.includes(nameFilter);
        const locationMatch = location.includes(locationFilter);
        const categoryMatch = !categoryFilter || category === categoryFilter;

        row.style.display = (nameMatch && locationMatch && categoryMatch) ? '' : 'none';
    });
}

function clearFilters() {
    document.getElementById('nameFilter').value = '';
    document.getElementById('locationFilter').value = '';
    document.getElementById('categoryFilter').value = '';
    document.querySelectorAll('.data_tab tbody tr').forEach(row => {
        row.style.display = '';
    });
}
</script>
{% endblock %}
